C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2023 18:50:43 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: I:\Program\Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /**
   2            ************************************* Copyright ****************************** 
   3            *
   4            *                 (C) Copyright 2022, LQH, China, GCU.
   5            *                                All Rights Reserved
   6            *                              
   7            *                                      By LQH
   8            *                       
   9            * FileName   : main.c         
  10            * Author     : ÉÙÄêÇ±ÐÐ(snqx-lgh)                     
  11            * Date       : 2023-06-14         
  12            * Description: CSDNÖ÷Ò³£º https://blog.csdn.net/wan1234512?type=blog
  13                                       GiteeµØÖ·£ºhttps://gitee.com/snqx-lqh
  14            ******************************************************************************
  15            */
  16          #include <reg52.h>
  17          #include "main.h"
  18          #include <stdio.h>
  19          #include <string.h>
  20          
  21          #include "LCD1602.h"
  22          #include "KeyScan.h"
  23          
  24          u8 DisBuff[17]={0};//ÏÔÊ¾»º³åÇø
  25          u8 Password[7] = "666666";//³õÊ¼ÃÜÂë
  26          u8 KeyValueTable[16]={1,2,3,10,4,5,6,10,7,8,9,10,10,0,10,10};//¼üÅÌÓ³Éä±í
  27          
  28          bit OpenFlag   = 0;//¿ªËø¹¦ÄÜº¯Êý±êÖ¾Î»
  29          bit CloseFlag  = 0;//¹ØËø¹¦ÄÜº¯Êý±êÖ¾Î»
  30          bit ChangeFlag = 0;//ÐÞ¸ÄÃÜÂë¹¦ÄÜº¯Êý±êÖ¾Î»
  31          
  32          sbit LED = P2^4;
  33          
  34          void KeyDownFunction(void);
  35          void Timer0Init(void);
  36          
  37          void main()
  38          {
  39   1              LcdInit();
  40   1              Timer0Init();
  41   1          LED = 1;
  42   1              sprintf((char*)DisBuff,"combination lock");
  43   1              LcdShowStr(0,0,DisBuff);
  44   1          sprintf((char*)DisBuff,"----  lock  ----");
  45   1              LcdShowStr(0,1,DisBuff);
  46   1              while(1)
  47   1              {
  48   2              KeyDownFunction();
  49   2              }
  50   1      }
  51          
  52          /**
  53            * @Name    OpenLock
  54            * @brief   ¿ªËøÏà¹ØµÄ¹¦ÄÜº¯Êý£¬ÊäÈëÃÜÂë
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2023 18:50:43 PAGE 2   

  55            * @param   KeyValueTemp: Êµ¼ÊµÄ°´¼üÖµ 
  56            * @retval
  57           **/
  58          void OpenLock(u8 KeyValueTemp)
  59          {
  60   1          static u8 OpenCount = 0;
  61   1          static u8 PasswordTemp[7] = {0};
  62   1          if(OpenCount == 0)//Ò»¸ö¼ÆÊýÆ÷£¬Îª0Ê±£¬¾ÍÊÇ¸Õ½øÈë¿ªËø×´Ì¬µÄÊ±ºò£¬ÏÔÊ¾pwd :×Ö·û´®
  63   1          {
  64   2              sprintf((char*)DisBuff,"pwd :           ");
  65   2              LcdShowStr(0,1,DisBuff);
  66   2              OpenCount++;//ÏÔÊ¾Íêºó°Ñ¼ÆÊýÆ÷¼ÓÒ»
  67   2          }else//ÏÂ´Îµã»÷¾Í½øÈëelse
  68   1          {
  69   2              if(KeyValueTemp == KEY_Back && OpenCount > 1)//µ±µã»÷»ØÍË°´Å¥
  70   2              {
  71   3                  OpenCount --;//»Øµ½ÉÏÒ»¸öÃÜÂëÊýµÄÎ»ÖÃ
  72   3                  DisBuff[OpenCount+5] = ' ';//½«ÏÔÊ¾Î»Çå¿Õ
  73   3                  PasswordTemp[OpenCount-1] = 0;//½«¸ÃÎ»ÃÜÂëÖÃ0£¬ÒòÎªÃÜÂëÊ¹ÓÃµÄ×Ö·û´®£¬Ò»°ãASCLL²»»áÎª0
  74   3                  LcdShowStr(0,1,DisBuff);
  75   3              }else if(OpenCount < 7)//ÃÜÂëÉè¶¨Îª6Î»£¬ËùÒÔ6Î»ÊäÍêºó¾Í²»½øÈëÊäÃÜÂëµÄ¹¦ÄÜ¿éÁË
  76   2              {
  77   3                  /*
  78   3                      ÕâÀïÓÐ¸öKeyValueTableÊÇÒòÎª°´¼ü°´ÏÂµÄÖµ²»ÊÇÊµ¼ÊÎÒÅÅ°æµÄÖµ£¬ËùÒÔÓÃÊý×é×öÁËÒ»´Î×ª»»
  79   3                  */
  80   3                  DisBuff[OpenCount+5] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÏÔÊ¾Î»ÏÔÊ¾ÊäÈëµÄÊýÖµ
  81   3                  PasswordTemp[OpenCount-1] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÊäÈëµÄÊýÖµ±£´æ
  82   3                  LcdShowStr(0,1,DisBuff);
  83   3                  OpenCount++;//¸ÃÎ»´¦ÀíÍêºó½øµ½ÏÂÒ»Î»
  84   3              }
  85   2          }
  86   1          if(OpenCount > 6 && KeyValueTemp == KEY_Confirm)//6Î»ÃÜÂëÊäÍê£¬ÓÖµã»÷ÁËÈ·ÈÏ°´Å¥µÄ»°£¬¾Í¿ªÊ¼±È½ÏÃÜÂë
  87   1          {
  88   2              OpenFlag  = 0;
  89   2              OpenCount = 0;
  90   2              if(strcmp(Password,PasswordTemp)==0)
  91   2              {
  92   3                  sprintf((char*)DisBuff,"----  open  ----");
  93   3                  LcdShowStr(0,1,DisBuff);
  94   3                  LED = 0;
  95   3              }else
  96   2              {
  97   3                  sprintf((char*)DisBuff,"----  lock  ----");
  98   3                  LcdShowStr(0,1,DisBuff);
  99   3                  LED = 1;
 100   3              }
 101   2          }
 102   1      }
 103          
 104          /**
 105            * @Name    ChangePassword
 106            * @brief   ÐÞ¸ÄÃÜÂëµÄÏà¹Øº¯Êý
 107            * @param   KeyValueTemp: Êµ¼ÊµÄ°´¼üÖµ
 108            * @retval
 109           **/
 110          void ChangePassword(u8 KeyValueTemp)
 111          {
 112   1          static u8 ChangeCount = 0;
 113   1          static u8 ChangeMode  = 0;//0ÊÇÊäÈë¾ÉÃÜÂë£¬1ÊÇÊäÈëÐÂÃÜÂë
 114   1          static u8 PasswordTemp[7] = {0};
 115   1          static u8 NewPasswordTemp[7] = {0};
 116   1          if(ChangeMode == 0)
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2023 18:50:43 PAGE 3   

 117   1          {
 118   2              if(ChangeCount == 0)//Ò»¸ö¼ÆÊýÆ÷£¬Îª0Ê±£¬¾ÍÊÇ¸Õ½øÈëÐÞ¸ÄÃÜÂë×´Ì¬µÄÊ±ºò£¬ÏÔÊ¾pwd :×Ö·û´®
 119   2              {
 120   3                  sprintf((char*)DisBuff,"pwd :           ");
 121   3                  LcdShowStr(0,1,DisBuff);
 122   3                  ChangeCount++;//ÏÔÊ¾Íêºó°Ñ¼ÆÊýÆ÷¼ÓÒ»
 123   3              }else//ÏÂ´Îµã»÷¾Í½øÈëelse
 124   2              {
 125   3                  if(KeyValueTemp == KEY_Back && ChangeCount > 1)//µ±µã»÷»ØÍË°´Å¥
 126   3                  {
 127   4                      ChangeCount --;//»Øµ½ÉÏÒ»¸öÃÜÂëÊýµÄÎ»ÖÃ
 128   4                      DisBuff[ChangeCount+5] = ' ';//½«ÏÔÊ¾Î»Çå¿Õ
 129   4                      PasswordTemp[ChangeCount-1] = 0;//½«¸ÃÎ»ÃÜÂëÖÃ0£¬ÒòÎªÃÜÂëÊ¹ÓÃµÄ×Ö·û´®£¬Ò»°ãASCLL²»»áÎª0
 130   4                      LcdShowStr(0,1,DisBuff);
 131   4                  }else if(ChangeCount < 7)//ÃÜÂëÉè¶¨Îª6Î»£¬ËùÒÔ6Î»ÊäÍêºó¾Í²»½øÈëÊäÃÜÂëµÄ¹¦ÄÜ¿éÁË
 132   3                  {
 133   4                      /*
 134   4                          ÕâÀïÓÐ¸öKeyValueTableÊÇÒòÎª°´¼ü°´ÏÂµÄÖµ²»ÊÇÊµ¼ÊÎÒÅÅ°æµÄÖµ£¬ËùÒÔÓÃÊý×é×öÁËÒ»´Î×ª»»
 135   4                      */
 136   4                      DisBuff[ChangeCount+5] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÏÔÊ¾Î»ÏÔÊ¾ÊäÈëµÄÊýÖµ
 137   4                      PasswordTemp[ChangeCount-1] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÊäÈëµÄÊýÖµ±£´æ
 138   4                      LcdShowStr(0,1,DisBuff);
 139   4                      ChangeCount++;//¸ÃÎ»´¦ÀíÍêºó½øµ½ÏÂÒ»Î»
 140   4                  }
 141   3              }
 142   2              if(ChangeCount > 6 && KeyValueTemp == KEY_Confirm)//6Î»ÃÜÂëÊäÍê£¬ÓÖµã»÷ÁËÈ·ÈÏ°´Å¥µÄ»°£¬¾Í¿ªÊ¼±È½ÏÃ
             -ÜÂë
 143   2              {
 144   3                  ChangeCount = 0;
 145   3                  if(strcmp(Password,PasswordTemp)==0)//ÃÜÂëÕýÈ·¾Í¿ÉÒÔÊäÈëÐÂÃÜÂëÁË
 146   3                  {
 147   4                      sprintf((char*)DisBuff,"new :           ");
 148   4                      LcdShowStr(0,1,DisBuff);
 149   4                      ChangeCount ++;
 150   4                      ChangeMode = 1;
 151   4                  }else
 152   3                  {
 153   4                      ChangeFlag  = 0;
 154   4                      sprintf((char*)DisBuff,"----  lock  ----");
 155   4                      LcdShowStr(0,1,DisBuff);
 156   4                      LED = 1;
 157   4                  }
 158   3              }
 159   2          }else if(ChangeMode == 1)
 160   1          {
 161   2              if(KeyValueTemp == KEY_Back && ChangeCount > 1)//µ±µã»÷»ØÍË°´Å¥
 162   2              {
 163   3                  ChangeCount --;//»Øµ½ÉÏÒ»¸öÃÜÂëÊýµÄÎ»ÖÃ
 164   3                  DisBuff[ChangeCount+5] = ' ';//½«ÏÔÊ¾Î»Çå¿Õ
 165   3                  NewPasswordTemp[ChangeCount-1] = 0;//½«¸ÃÎ»ÃÜÂëÖÃ0£¬ÒòÎªÃÜÂëÊ¹ÓÃµÄ×Ö·û´®£¬Ò»°ãASCLL²»»áÎª0
 166   3                  LcdShowStr(0,1,DisBuff);
 167   3              }else if(ChangeCount < 7)//ÃÜÂëÉè¶¨Îª6Î»£¬ËùÒÔ6Î»ÊäÍêºó¾Í²»½øÈëÊäÃÜÂëµÄ¹¦ÄÜ¿éÁË
 168   2              {
 169   3                  /*
 170   3                      ÕâÀïÓÐ¸öKeyValueTableÊÇÒòÎª°´¼ü°´ÏÂµÄÖµ²»ÊÇÊµ¼ÊÎÒÅÅ°æµÄÖµ£¬ËùÒÔÓÃÊý×é×öÁËÒ»´Î×ª»»
 171   3                  */
 172   3                  DisBuff[ChangeCount+5] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÏÔÊ¾Î»ÏÔÊ¾ÊäÈëµÄÊýÖµ
 173   3                  NewPasswordTemp[ChangeCount-1] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÊäÈëµÄÊýÖµ±£´æ
 174   3                  LcdShowStr(0,1,DisBuff);
 175   3                  ChangeCount++;//¸ÃÎ»´¦ÀíÍêºó½øµ½ÏÂÒ»Î»
 176   3              }
 177   2              if(ChangeCount > 6 && KeyValueTemp == KEY_Confirm)//6Î»ÃÜÂëÊäÍê£¬ÓÖµã»÷ÁËÈ·ÈÏ°´Å¥µÄ»°£¬¾Í¿ªÊ¼±È½ÏÃ
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2023 18:50:43 PAGE 4   

             -ÜÂë
 178   2              {
 179   3                  ChangeFlag  = 0;
 180   3                  ChangeCount = 0;
 181   3                  sprintf((char*)DisBuff,"---- success----");
 182   3                  LcdShowStr(0,1,DisBuff);
 183   3                  ChangeMode = 0;
 184   3                  strcpy(Password,NewPasswordTemp);
 185   3              }
 186   2          }
 187   1      }
 188          /**
 189            * @Name    KeyDownFunction
 190            * @brief   °´¼ü°´ÏÂºóµÄ¹¦ÄÜº¯Êý
 191            * @param   : [ÊäÈë/³ö] 
 192            * @retval  
 193           **/
 194          void KeyDownFunction()
 195          {
 196   1          u8 KeyValueTemp = 0;
 197   1          if(KeyState == 1)
 198   1          {
 199   2              KeyValueTemp = KeyValue;
 200   2              if(KeyValue != 0)//ÊµÏÖµ¥´Î¼ì²â°´¼ü
 201   2                  KeyValue = 0;
 202   2              if(KeyValueTemp == KEY_Open && OpenFlag == 0)//Ê¹ÄÜ¿ªËø¹¦ÄÜº¯Êý
 203   2              {
 204   3                  OpenFlag   = 1;
 205   3              }else if(KeyValueTemp == KEY_Close && CloseFlag == 0)//Ê¹ÄÜ¹ØËø¹¦ÄÜº¯Êý
 206   2              {
 207   3                  CloseFlag  = 1;
 208   3              }else if(KeyValueTemp == KEY_Change && ChangeFlag == 0)//Ê¹ÄÜÐÞ¸ÄÃÜÂë¹¦ÄÜº¯Êý
 209   2              {
 210   3                  ChangeFlag = 1;
 211   3              }
 212   2              if(OpenFlag == 1)//¿ªËø¹¦ÄÜÊ¹ÄÜ
 213   2              {  
 214   3                  OpenLock(KeyValueTemp);
 215   3              }
 216   2              if(CloseFlag == 1)//¹ØËø¹¦ÄÜÊ¹ÄÜ
 217   2              {
 218   3                  sprintf((char*)DisBuff,"----  lock  ----");
 219   3                  LcdShowStr(0,1,DisBuff);
 220   3                  CloseFlag = 0;
 221   3                  LED = 1;
 222   3              }
 223   2              if(ChangeFlag == 1)//ÐÞ¸ÄÃÜÂë¹¦ÄÜÊ¹ÄÜ
 224   2              {
 225   3                  ChangePassword(KeyValueTemp);
 226   3              }
 227   2          }
 228   1      }
 229          
 230          void Timer0Init(void) //5ºÁÃë@12MHz
 231          {
 232   1          TMOD = 0x01; //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 233   1          TL0 = 0x78;  //ÉèÖÃ¶¨Ê±0³õÊ¼Öµ
 234   1          TH0 = 0xEC;  //ÉèÖÃ¶¨Ê±0³õÊ¼Öµ
 235   1          TF0 = 0;     //Çå³ýTF0±êÖ¾
 236   1          TR0 = 1;     //¶¨Ê±Æ÷0¿ªÊ¼¼ÆÊ±
 237   1          ET0 = 1;
 238   1          EA = 1;
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2023 18:50:43 PAGE 5   

 239   1      }
 240          
 241          void Timer0() interrupt 1
 242          {
 243   1          TL0 = 0x78; //ÉèÖÃ¶¨Ê±0³õÊ¼Öµ
 244   1          TH0 = 0xEC; //ÉèÖÃ¶¨Ê±0³õÊ¼Öµ
 245   1          KeyScan();
 246   1      
 247   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    942    ----
   CONSTANT SIZE    =    102    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     64       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
