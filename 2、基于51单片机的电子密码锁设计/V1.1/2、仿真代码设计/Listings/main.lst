C51 COMPILER V9.60.0.0   MAIN                                                              07/05/2025 14:29:57 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\Program\Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /**
   2            ************************************* Copyright ****************************** 
   3            *
   4            *                 (C) Copyright 2022, LQH, China, GCU.
   5            *                                All Rights Reserved
   6            *                              
   7            *                                      By LQH
   8            *                       
   9            * FileName   : main.c         
  10            * Author     : ÉÙÄêÇ±ĞĞ(snqx-lgh)                     
  11            * Date       : 2023-06-14         
  12            * Description: CSDNÖ÷Ò³£º https://blog.csdn.net/wan1234512?type=blog
  13                                       GiteeµØÖ·£ºhttps://gitee.com/snqx-lqh
  14            ******************************************************************************
  15            */
  16          #include <reg52.h>
  17          #include "main.h"
  18          #include <stdio.h>
  19          #include <string.h>
  20          
  21          #include "LCD1602.h"
  22          #include "KeyScan.h"
  23          
  24          u8 DisBuff[17]={0};//ÏÔÊ¾»º³åÇø
  25          u8 Password[7] = "666666";//³õÊ¼ÃÜÂë
  26          u8 KeyValueTable[16]={1,2,3,10,4,5,6,10,7,8,9,10,10,0,10,10};//¼üÅÌÓ³Éä±í
  27          
  28          u8 KeyValueGet = 0;
  29          
  30          bit OpenFlag   = 0;//¿ªËø¹¦ÄÜº¯Êı±êÖ¾Î»
  31          bit CloseFlag  = 0;//¹ØËø¹¦ÄÜº¯Êı±êÖ¾Î»
  32          bit ChangeFlag = 0;//ĞŞ¸ÄÃÜÂë¹¦ÄÜº¯Êı±êÖ¾Î»
  33          
  34          sbit LED = P2^4;
  35          
  36          void KeyDownFunction(void);
  37          void Timer0Init(void);
  38          
  39          void main()
  40          {
  41   1              LcdInit();
  42   1              Timer0Init();
  43   1          LED = 1;
  44   1              sprintf((char*)DisBuff,"combination lock");
  45   1              LcdShowStr(0,0,DisBuff);
  46   1          sprintf((char*)DisBuff,"----  lock  ----");
  47   1              LcdShowStr(0,1,DisBuff);
  48   1              while(1)
  49   1              {
  50   2                      if(KeyValueGet != 0)
  51   2                              KeyDownFunction();
  52   2              }
  53   1      }
  54          
C51 COMPILER V9.60.0.0   MAIN                                                              07/05/2025 14:29:57 PAGE 2   

  55          /**
  56            * @Name    OpenLock
  57            * @brief   ¿ªËøÏà¹ØµÄ¹¦ÄÜº¯Êı£¬ÊäÈëÃÜÂë
  58            * @param   KeyValueTemp: Êµ¼ÊµÄ°´¼üÖµ 
  59            * @retval
  60           **/
  61          void OpenLock(u8 KeyValueTemp)
  62          {
  63   1          static u8 OpenCount = 0;
  64   1          static u8 PasswordTemp[7] = {0};
  65   1          if(OpenCount == 0)//Ò»¸ö¼ÆÊıÆ÷£¬Îª0Ê±£¬¾ÍÊÇ¸Õ½øÈë¿ªËø×´Ì¬µÄÊ±ºò£¬ÏÔÊ¾pwd :×Ö·û´®
  66   1          {
  67   2              sprintf((char*)DisBuff,"pwd :           ");
  68   2              LcdShowStr(0,1,DisBuff);
  69   2              OpenCount++;//ÏÔÊ¾Íêºó°Ñ¼ÆÊıÆ÷¼ÓÒ»
  70   2          }else//ÏÂ´Îµã»÷¾Í½øÈëelse
  71   1          {
  72   2              if(KeyValueTemp == KEY_Back && OpenCount > 1)//µ±µã»÷»ØÍË°´Å¥
  73   2              {
  74   3                  OpenCount --;//»Øµ½ÉÏÒ»¸öÃÜÂëÊıµÄÎ»ÖÃ
  75   3                  DisBuff[OpenCount+5] = ' ';//½«ÏÔÊ¾Î»Çå¿Õ
  76   3                  PasswordTemp[OpenCount-1] = 0;//½«¸ÃÎ»ÃÜÂëÖÃ0£¬ÒòÎªÃÜÂëÊ¹ÓÃµÄ×Ö·û´®£¬Ò»°ãASCLL²»»áÎª0
  77   3                  LcdShowStr(0,1,DisBuff);
  78   3              }else if(OpenCount < 7)//ÃÜÂëÉè¶¨Îª6Î»£¬ËùÒÔ6Î»ÊäÍêºó¾Í²»½øÈëÊäÃÜÂëµÄ¹¦ÄÜ¿éÁË
  79   2              {
  80   3                  /*
  81   3                      ÕâÀïÓĞ¸öKeyValueTableÊÇÒòÎª°´¼ü°´ÏÂµÄÖµ²»ÊÇÊµ¼ÊÎÒÅÅ°æµÄÖµ£¬ËùÒÔÓÃÊı×é×öÁËÒ»´Î×ª»»
  82   3                  */
  83   3                  DisBuff[OpenCount+5] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÏÔÊ¾Î»ÏÔÊ¾ÊäÈëµÄÊıÖµ
  84   3                  PasswordTemp[OpenCount-1] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÊäÈëµÄÊıÖµ±£´æ
  85   3                  LcdShowStr(0,1,DisBuff);
  86   3                  OpenCount++;//¸ÃÎ»´¦ÀíÍêºó½øµ½ÏÂÒ»Î»
  87   3              }
  88   2          }
  89   1          if(OpenCount > 6 && KeyValueTemp == KEY_Confirm)//6Î»ÃÜÂëÊäÍê£¬ÓÖµã»÷ÁËÈ·ÈÏ°´Å¥µÄ»°£¬¾Í¿ªÊ¼±È½ÏÃÜÂë
  90   1          {
  91   2              OpenFlag  = 0;
  92   2              OpenCount = 0;
  93   2              if(strcmp(Password,PasswordTemp)==0)
  94   2              {
  95   3                  sprintf((char*)DisBuff,"----  open  ----");
  96   3                  LcdShowStr(0,1,DisBuff);
  97   3                  LED = 0;
  98   3              }else
  99   2              {
 100   3                  sprintf((char*)DisBuff,"----  lock  ----");
 101   3                  LcdShowStr(0,1,DisBuff);
 102   3                  LED = 1;
 103   3              }
 104   2          }
 105   1      }
 106          
 107          /**
 108            * @Name    ChangePassword
 109            * @brief   ĞŞ¸ÄÃÜÂëµÄÏà¹Øº¯Êı
 110            * @param   KeyValueTemp: Êµ¼ÊµÄ°´¼üÖµ
 111            * @retval
 112           **/
 113          void ChangePassword(u8 KeyValueTemp)
 114          {
 115   1          static u8 ChangeCount = 0;
 116   1          static u8 ChangeMode  = 0;//0ÊÇÊäÈë¾ÉÃÜÂë£¬1ÊÇÊäÈëĞÂÃÜÂë
C51 COMPILER V9.60.0.0   MAIN                                                              07/05/2025 14:29:57 PAGE 3   

 117   1          static u8 PasswordTemp[7] = {0};
 118   1          static u8 NewPasswordTemp[7] = {0};
 119   1          if(ChangeMode == 0)
 120   1          {
 121   2              if(ChangeCount == 0)//Ò»¸ö¼ÆÊıÆ÷£¬Îª0Ê±£¬¾ÍÊÇ¸Õ½øÈëĞŞ¸ÄÃÜÂë×´Ì¬µÄÊ±ºò£¬ÏÔÊ¾pwd :×Ö·û´®
 122   2              {
 123   3                  sprintf((char*)DisBuff,"pwd :           ");
 124   3                  LcdShowStr(0,1,DisBuff);
 125   3                  ChangeCount++;//ÏÔÊ¾Íêºó°Ñ¼ÆÊıÆ÷¼ÓÒ»
 126   3              }else//ÏÂ´Îµã»÷¾Í½øÈëelse
 127   2              {
 128   3                  if(KeyValueTemp == KEY_Back && ChangeCount > 1)//µ±µã»÷»ØÍË°´Å¥
 129   3                  {
 130   4                      ChangeCount --;//»Øµ½ÉÏÒ»¸öÃÜÂëÊıµÄÎ»ÖÃ
 131   4                      DisBuff[ChangeCount+5] = ' ';//½«ÏÔÊ¾Î»Çå¿Õ
 132   4                      PasswordTemp[ChangeCount-1] = 0;//½«¸ÃÎ»ÃÜÂëÖÃ0£¬ÒòÎªÃÜÂëÊ¹ÓÃµÄ×Ö·û´®£¬Ò»°ãASCLL²»»áÎª0
 133   4                      LcdShowStr(0,1,DisBuff);
 134   4                  }else if(ChangeCount < 7)//ÃÜÂëÉè¶¨Îª6Î»£¬ËùÒÔ6Î»ÊäÍêºó¾Í²»½øÈëÊäÃÜÂëµÄ¹¦ÄÜ¿éÁË
 135   3                  {
 136   4                      /*
 137   4                          ÕâÀïÓĞ¸öKeyValueTableÊÇÒòÎª°´¼ü°´ÏÂµÄÖµ²»ÊÇÊµ¼ÊÎÒÅÅ°æµÄÖµ£¬ËùÒÔÓÃÊı×é×öÁËÒ»´Î×ª»»
 138   4                      */
 139   4                      DisBuff[ChangeCount+5] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÏÔÊ¾Î»ÏÔÊ¾ÊäÈëµÄÊıÖµ
 140   4                      PasswordTemp[ChangeCount-1] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÊäÈëµÄÊıÖµ±£´æ
 141   4                      LcdShowStr(0,1,DisBuff);
 142   4                      ChangeCount++;//¸ÃÎ»´¦ÀíÍêºó½øµ½ÏÂÒ»Î»
 143   4                  }
 144   3              }
 145   2              if(ChangeCount > 6 && KeyValueTemp == KEY_Confirm)//6Î»ÃÜÂëÊäÍê£¬ÓÖµã»÷ÁËÈ·ÈÏ°´Å¥µÄ»°£¬¾Í¿ªÊ¼±È½ÏÃ
             -ÜÂë
 146   2              {
 147   3                  ChangeCount = 0;
 148   3                  if(strcmp(Password,PasswordTemp)==0)//ÃÜÂëÕıÈ·¾Í¿ÉÒÔÊäÈëĞÂÃÜÂëÁË
 149   3                  {
 150   4                      sprintf((char*)DisBuff,"new :           ");
 151   4                      LcdShowStr(0,1,DisBuff);
 152   4                      ChangeCount ++;
 153   4                      ChangeMode = 1;
 154   4                  }else
 155   3                  {
 156   4                      ChangeFlag  = 0;
 157   4                      sprintf((char*)DisBuff,"----  lock  ----");
 158   4                      LcdShowStr(0,1,DisBuff);
 159   4                      LED = 1;
 160   4                  }
 161   3              }
 162   2          }else if(ChangeMode == 1)
 163   1          {
 164   2              if(KeyValueTemp == KEY_Back && ChangeCount > 1)//µ±µã»÷»ØÍË°´Å¥
 165   2              {
 166   3                  ChangeCount --;//»Øµ½ÉÏÒ»¸öÃÜÂëÊıµÄÎ»ÖÃ
 167   3                  DisBuff[ChangeCount+5] = ' ';//½«ÏÔÊ¾Î»Çå¿Õ
 168   3                  NewPasswordTemp[ChangeCount-1] = 0;//½«¸ÃÎ»ÃÜÂëÖÃ0£¬ÒòÎªÃÜÂëÊ¹ÓÃµÄ×Ö·û´®£¬Ò»°ãASCLL²»»áÎª0
 169   3                  LcdShowStr(0,1,DisBuff);
 170   3              }else if(ChangeCount < 7)//ÃÜÂëÉè¶¨Îª6Î»£¬ËùÒÔ6Î»ÊäÍêºó¾Í²»½øÈëÊäÃÜÂëµÄ¹¦ÄÜ¿éÁË
 171   2              {
 172   3                  /*
 173   3                      ÕâÀïÓĞ¸öKeyValueTableÊÇÒòÎª°´¼ü°´ÏÂµÄÖµ²»ÊÇÊµ¼ÊÎÒÅÅ°æµÄÖµ£¬ËùÒÔÓÃÊı×é×öÁËÒ»´Î×ª»»
 174   3                  */
 175   3                  DisBuff[ChangeCount+5] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÏÔÊ¾Î»ÏÔÊ¾ÊäÈëµÄÊıÖµ
 176   3                  NewPasswordTemp[ChangeCount-1] = '0' + KeyValueTable[KeyValueTemp-1];//½«ÊäÈëµÄÊıÖµ±£´æ
 177   3                  LcdShowStr(0,1,DisBuff);
C51 COMPILER V9.60.0.0   MAIN                                                              07/05/2025 14:29:57 PAGE 4   

 178   3                  ChangeCount++;//¸ÃÎ»´¦ÀíÍêºó½øµ½ÏÂÒ»Î»
 179   3              }
 180   2              if(ChangeCount > 6 && KeyValueTemp == KEY_Confirm)//6Î»ÃÜÂëÊäÍê£¬ÓÖµã»÷ÁËÈ·ÈÏ°´Å¥µÄ»°£¬¾Í¿ªÊ¼±È½ÏÃ
             -ÜÂë
 181   2              {
 182   3                  ChangeFlag  = 0;
 183   3                  ChangeCount = 0;
 184   3                  sprintf((char*)DisBuff,"---- success----");
 185   3                  LcdShowStr(0,1,DisBuff);
 186   3                  ChangeMode = 0;
 187   3                  strcpy(Password,NewPasswordTemp);
 188   3              }
 189   2          }
 190   1      }
 191          /**
 192            * @Name    KeyDownFunction
 193            * @brief   °´¼ü°´ÏÂºóµÄ¹¦ÄÜº¯Êı
 194            * @param   : [ÊäÈë/³ö] 
 195            * @retval  
 196           **/
 197          void KeyDownFunction()
 198          {
 199   1          u8 KeyValueTemp = 0;
 200   1      //    if(KeyState == 1)
 201   1      //    {
 202   1              KeyValueTemp = KeyValueGet;
 203   1      //        if(KeyValue != 0)//ÊµÏÖµ¥´Î¼ì²â°´¼ü
 204   1      //            KeyValue = 0;
 205   1              if(KeyValueTemp == KEY_Open && OpenFlag == 0)//Ê¹ÄÜ¿ªËø¹¦ÄÜº¯Êı
 206   1              {
 207   2                  OpenFlag   = 1;
 208   2              }else if(KeyValueTemp == KEY_Close && CloseFlag == 0)//Ê¹ÄÜ¹ØËø¹¦ÄÜº¯Êı
 209   1              {
 210   2                  CloseFlag  = 1;
 211   2              }else if(KeyValueTemp == KEY_Change && ChangeFlag == 0)//Ê¹ÄÜĞŞ¸ÄÃÜÂë¹¦ÄÜº¯Êı
 212   1              {
 213   2                  ChangeFlag = 1;
 214   2              }
 215   1              if(OpenFlag == 1)//¿ªËø¹¦ÄÜÊ¹ÄÜ
 216   1              {  
 217   2                  OpenLock(KeyValueTemp);
 218   2              }
 219   1              if(CloseFlag == 1)//¹ØËø¹¦ÄÜÊ¹ÄÜ
 220   1              {
 221   2                  sprintf((char*)DisBuff,"----  lock  ----");
 222   2                  LcdShowStr(0,1,DisBuff);
 223   2                  CloseFlag = 0;
 224   2                  LED = 1;
 225   2              }
 226   1              if(ChangeFlag == 1)//ĞŞ¸ÄÃÜÂë¹¦ÄÜÊ¹ÄÜ
 227   1              {
 228   2                  ChangePassword(KeyValueTemp);
 229   2              }
 230   1      //    }
 231   1      }
 232          
 233          void Timer0Init(void) //5ºÁÃë@12MHz
 234          {
 235   1          TMOD = 0x01; //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 236   1          TL0 = 0x78;  //ÉèÖÃ¶¨Ê±0³õÊ¼Öµ
 237   1          TH0 = 0xEC;  //ÉèÖÃ¶¨Ê±0³õÊ¼Öµ
 238   1          TF0 = 0;     //Çå³ıTF0±êÖ¾
C51 COMPILER V9.60.0.0   MAIN                                                              07/05/2025 14:29:57 PAGE 5   

 239   1          TR0 = 1;     //¶¨Ê±Æ÷0¿ªÊ¼¼ÆÊ±
 240   1          ET0 = 1;
 241   1          EA = 1;
 242   1      }
 243          
 244          void Timer0() interrupt 1
 245          {
 246   1          TL0 = 0x78; //ÉèÖÃ¶¨Ê±0³õÊ¼Öµ
 247   1          TH0 = 0xEC; //ÉèÖÃ¶¨Ê±0³õÊ¼Öµ
 248   1          KeyValueGet = KeyScan();
 249   1      
 250   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    934    ----
   CONSTANT SIZE    =    102    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     65       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
